<table class="table align-middle staff-consultant-table">
  <caption class="visually-hidden">{{ active_status_label }} consultant applications with available staff actions</caption>
  <thead class="staff-consultant-table__head">
    <tr>
      <th scope="col" class="staff-consultant-table__heading">
        <a
          class="staff-consultant-table__sort d-inline-flex align-items-center gap-1 text-decoration-none"
          href="{% url 'staff_dashboard' %}?{{ sort_links.created_at.querystring }}"
          hx-get="{% url 'staff_dashboard' %}?{{ sort_links.created_at.querystring }}"
          hx-target="#consultant-results"
          hx-swap="outerHTML"
          hx-push-url="true"
          hx-indicator="#results-loading"
        >
          Date Created
          {% if sort_links.created_at.is_active %}
            <span aria-hidden="true">{% if sort_links.created_at.direction == 'asc' %}▲{% else %}▼{% endif %}</span>
          {% else %}
            <span class="text-muted" aria-hidden="true">↕</span>
          {% endif %}
        </a>
      </th>
      <th scope="col" class="staff-consultant-table__heading">Consultant</th>
      <th scope="col" class="staff-consultant-table__heading">Business</th>
      <th scope="col" class="staff-consultant-table__heading">
        <a
          class="staff-consultant-table__sort d-inline-flex align-items-center gap-1 text-decoration-none"
          href="{% url 'staff_dashboard' %}?{{ sort_links.status.querystring }}"
          hx-get="{% url 'staff_dashboard' %}?{{ sort_links.status.querystring }}"
          hx-target="#consultant-results"
          hx-swap="outerHTML"
          hx-push-url="true"
          hx-indicator="#results-loading"
        >
          Status
          {% if sort_links.status.is_active %}
            <span aria-hidden="true">{% if sort_links.status.direction == 'asc' %}▲{% else %}▼{% endif %}</span>
          {% else %}
            <span class="text-muted" aria-hidden="true">↕</span>
          {% endif %}
        </a>
      </th>
      <th scope="col" class="staff-consultant-table__heading">Comment &amp; Actions</th>
    </tr>
  </thead>
  <tbody class="staff-consultant-table__body">
    {% for consultant in page_obj %}
      <tr class="staff-consultant-table__row">
        <td class="staff-consultant-table__cell">
          {% if consultant.created_at %}
            {{ consultant.created_at|date:"M d, Y H:i" }}
          {% else %}
            —
          {% endif %}
        </td>
        <td class="staff-consultant-table__cell">
          <div class="fw-semibold">{{ consultant.full_name }}</div>
          <div class="text-muted small">ID: {{ consultant.id_number }} · {{ consultant.email }}</div>
        </td>
        <td class="staff-consultant-table__cell">
          <div class="fw-semibold">{{ consultant.business_name }}</div>
          <div class="text-muted small">{{ consultant.phone_number }}</div>
        </td>
        <td class="staff-consultant-table__cell">{{ consultant.get_status_display }}</td>
        <td class="staff-consultant-table__cell staff-consultant-table__cell--actions">
          <form method="post" action="{% url 'staff_dashboard' %}" class="staff-consultant-table__form d-flex flex-column gap-2">
            {% csrf_token %}
            <input type="hidden" name="consultant_id" value="{{ consultant.id }}">
            <input type="hidden" name="status" value="{{ active_status }}">
            <input type="hidden" name="q" value="{{ search_query }}">
            <input type="hidden" name="sort" value="{{ sort_field }}">
            <input type="hidden" name="direction" value="{{ sort_direction }}">
            <input type="hidden" name="page" value="{{ page_obj.number }}">
            <label class="visually-hidden" for="comment-{{ consultant.id }}">Internal comment</label>
            <textarea id="comment-{{ consultant.id }}" name="comment" class="form-control form-control-sm staff-consultant-table__comment" rows="2" placeholder="Add a note for other staff members">{{ consultant.staff_comment|default_if_none:"" }}</textarea>
            <div class="staff-consultant-table__actions d-flex flex-wrap gap-2">
              <button type="submit" name="action" value="approved" class="btn btn-success btn-sm">Approve</button>
              <button type="submit" name="action" value="rejected" class="btn btn-danger btn-sm">Reject</button>
              <button type="submit" name="action" value="incomplete" class="btn btn-warning btn-sm">Mark Incomplete</button>
              <a href="{% url 'staff_consultant_detail' consultant.pk %}" class="btn btn-outline-primary btn-sm">View</a>
            </div>
          </form>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
