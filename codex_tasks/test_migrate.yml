task_name: Test Django Migrations
actions:
  # 1Ô∏è‚É£ Ensure venv active
  - type: shell
    cmd: |
      source venv/bin/activate || echo "‚ö†Ô∏è Activate your virtualenv manually before rerun"

  # 2Ô∏è‚É£ Run Django migrations
  - type: shell
    cmd: |
      echo "üèóÔ∏è  Running migrations..."
      export DJANGO_SETTINGS_MODULE=backend.settings.dev
      python manage.py migrate --noinput

  # 3Ô∏è‚É£ Verify PostgreSQL tables exist
  - type: shell
    cmd: |
      echo "üîç Checking tables in database..."
      PGPASSWORD=password psql -U cams_user -h 127.0.0.1 -d cams -c "\dt" || echo "‚ö†Ô∏è Could not list tables"

  # 4Ô∏è‚É£ Optional: check Django DB engine again for sanity
  - type: shell
    cmd: |
      echo "üß† Confirming database engine..."
      export DJANGO_SETTINGS_MODULE=backend.settings.dev
      python -m django shell -c "from django.conf import settings; print(settings.DATABASES['default'])"
