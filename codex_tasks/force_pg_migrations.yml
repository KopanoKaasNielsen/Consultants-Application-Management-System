task_name: Force PostgreSQL Migrations
actions:
  - type: shell
    cmd: |
      source venv/bin/activate || echo "âš ï¸ Activate your virtualenv manually before rerun"
      export DJANGO_SETTINGS_MODULE=backend.settings.dev

      echo "ğŸ§© Checking app configs..."
      grep -R "class .*Config" apps/*/apps.py || echo "âš ï¸ Could not detect app configs"

      echo ""
      echo "ğŸ—‘ï¸  Removing stale SQLite migration history if present..."
      if [ -f db.sqlite3 ]; then
        rm -f db.sqlite3 && echo "âœ… Removed old db.sqlite3"
      else
        echo "âœ” No SQLite file detected"
      fi

      echo ""
      echo "ğŸ”„ Rebuilding migration history in PostgreSQL..."
      python manage.py migrate --fake-initial

      echo ""
      echo "ğŸ“‹ Listing PostgreSQL tables..."
      PGPASSWORD=password psql -U cams_user -h 127.0.0.1 -d cams -c "\\dt"
