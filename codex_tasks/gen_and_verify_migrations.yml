task_name: Generate and Verify Migrations
actions:
  # 1Ô∏è‚É£ Ensure venv active
  - type: shell
    cmd: |
      source venv/bin/activate || echo "‚ö†Ô∏è Activate your virtualenv manually before rerun"

  # 2Ô∏è‚É£ Generate migrations for all apps
  - type: shell
    cmd: |
      echo "üß© Generating migrations for all apps..."
      export DJANGO_SETTINGS_MODULE=backend.settings.dev
      python manage.py makemigrations --noinput || echo "‚ö†Ô∏è makemigrations failed"

  # 3Ô∏è‚É£ Apply migrations
  - type: shell
    cmd: |
      echo "üèóÔ∏è Applying migrations..."
      export DJANGO_SETTINGS_MODULE=backend.settings.dev
      python manage.py migrate --noinput

  # 4Ô∏è‚É£ List PostgreSQL tables to confirm
  - type: shell
    cmd: |
      echo "üîç Verifying tables in PostgreSQL..."
      PGPASSWORD=password psql -U cams_user -h 127.0.0.1 -d cams -c "\dt" || echo "‚ö†Ô∏è Could not list tables"
