task_name: Restore INSTALLED_APPS block
actions:
  - type: shell
    cmd: |
      SETTINGS_FILE="backend/settings/base.py"
      echo "ğŸ§© Checking and restoring INSTALLED_APPS in $SETTINGS_FILE..."

      # Only add block if not already present
      if ! grep -q "INSTALLED_APPS" "$SETTINGS_FILE"; then
        echo "âš ï¸  No INSTALLED_APPS block found â€” writing default one..."
        {
          echo ""
          echo "# ============================================================================="
          echo "# Django and local application registration"
          echo "# ============================================================================="
          echo "INSTALLED_APPS = ["
          echo "    'django.contrib.admin',"
          echo "    'django.contrib.auth',"
          echo "    'django.contrib.contenttypes',"
          echo "    'django.contrib.sessions',"
          echo "    'django.contrib.messages',"
          echo "    'django.contrib.staticfiles',"
          echo ""
          echo "    # Local apps"
          echo "    'consultant_app',"
          echo "    'apps.api',"
          echo "    'apps.certificates',"
          echo "    'apps.consultants',"
          echo "    'apps.decisions',"
          echo "    'apps.security',"
          echo "    'apps.users',"
          echo "    'apps.vetting',"
          echo "]"
        } >> "$SETTINGS_FILE"
        echo "âœ… INSTALLED_APPS block added."
      else
        echo "âœ” INSTALLED_APPS already exists; confirm itâ€™s populated."
      fi

      echo ""
      echo "ğŸ—ï¸  Running system check..."
      source venv/bin/activate || true
      export DJANGO_SETTINGS_MODULE=backend.settings.dev
      python manage.py check
