{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-stack">
  {% if messages %}
  <section class="data-card" aria-live="polite">
    <ul class="message-list">
      {% for message in messages %}
      <li>{{ message }}</li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  <section class="data-card">
    <h2>Welcome, {{ user.username }}!</h2>
    <p class="card-subtitle">Manage your consultant application and review its latest status here.</p>
    {% if is_reviewer %}
    <div class="form-actions">
      <a class="btn-primary" href="{% url 'officer_applications_list' %}">Review applications</a>
      <a class="btn-secondary" href="{% url 'decisions_dashboard' %}">Decisions dashboard</a>
    </div>
    {% endif %}
  </section>

  <section class="data-card">
    <div class="card-header">
      <h3>Your application</h3>
      {% if application %}
      <span class="status-pill">{{ application.status|title }}</span>
      {% endif %}
    </div>

    {% if application %}
    <ul class="detail-list">
      <li><strong>Full Name:</strong> {{ application.full_name }}</li>
      <li><strong>ID Number:</strong> {{ application.id_number }}</li>
      <li><strong>Date of Birth:</strong> {{ application.dob }}</li>
      <li><strong>Business Name:</strong> {{ application.business_name }}</li>
      <li><strong>Submitted:</strong>
        {% if application.submitted_at and application.status != 'draft' %}
          {{ application.submitted_at|date:"F j, Y, g:i a" }}
        {% else %}
          Not submitted yet
        {% endif %}
      </li>
    </ul>

    <div class="form-actions">
      <a class="btn-secondary" href="{% url 'consultant_application_pdf' %}">Download PDF</a>
    </div>

    {% if document_fields %}
    <h4>Submitted documents</h4>
    <ul class="document-list">
      {% for document in document_fields %}
      <li>{{ document.label }} — <a href="{{ document.url }}" target="_blank" rel="noopener">Download</a></li>
      {% endfor %}
    </ul>
    {% endif %}

    {% if decision_documents %}
    <h4>Decision documents</h4>
    <ul class="document-list">
      {% for document in decision_documents %}
      <li>{{ document.label }} — <a href="{{ document.url }}" target="_blank" rel="noopener">Download</a></li>
      {% endfor %}
    </ul>
    {% endif %}

    {% if application.status == 'draft' %}
    <div class="form-actions">
      <a class="btn-secondary" href="{% url 'submit_application' %}">Edit your application</a>
    </div>
    {% endif %}
    {% include "documents/section.html" with
      section_class="data-card"
      content_class=""
      title="Supporting documents"
      documents=supporting_documents
      upload_form=document_upload_form
      upload_url=document_upload_url
      next_url=document_next_url
      can_upload=can_manage_documents
      can_delete=can_manage_documents
      empty_message="No supporting documents uploaded yet."
    %}
    {% else %}
    <p class="card-subtitle">No application submitted yet.</p>
    <div class="form-actions">
      <a class="btn-primary" href="{% url 'submit_application' %}">Start your application</a>
    </div>
    {% endif %}
  </section>
</div>
{% endblock %}
