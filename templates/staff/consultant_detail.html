{% extends "base.html" %}

{% block title %}Consultant Application{% endblock %}

{% block content %}
<div class="consultant-detail-shell">
  <div class="consultant-detail-container consultant-fade-in">
    <nav class="consultant-detail-breadcrumb" aria-label="Breadcrumb">
      <a href="{% url 'staff_dashboard' %}">Staff Dashboard</a>
      <span aria-hidden="true">/</span>
      <span aria-current="page">Consultant Application</span>
    </nav>

    <header class="consultant-detail-header">
      <div class="consultant-detail-header__text">
        <p class="consultant-detail-meta">
          Application #{{ consultant.pk }} · Status: {{ consultant.get_status_display }}
          {% if consultant.submitted_at %}
            · Submitted {{ consultant.submitted_at|date:"M d, Y" }}
          {% endif %}
        </p>
        <h1 class="consultant-detail-title">Consultant: {{ consultant.full_name }}</h1>
      </div>
      <a href="{% url 'staff_consultant_pdf' consultant.pk %}" class="consultant-detail-download">Download PDF</a>
    </header>

    <section class="consultant-summary-grid">
      <article class="consultant-summary-card consultant-summary-card--indigo">
        <h2>Personal Information</h2>
        <ul class="consultant-summary-list">
          <li><strong>Full name:</strong> {{ consultant.full_name }}</li>
          <li><strong>ID number:</strong> {{ consultant.id_number }}</li>
          <li><strong>Date of birth:</strong> {{ consultant.dob|date:"M d, Y" }}</li>
          <li><strong>Gender:</strong> {{ consultant.get_gender_display }}</li>
          <li><strong>Nationality:</strong> {{ consultant.nationality }}</li>
          <li><strong>Email:</strong> <a href="mailto:{{ consultant.email }}">{{ consultant.email }}</a></li>
          <li><strong>Phone number:</strong> {{ consultant.phone_number }}</li>
        </ul>
      </article>

      <article class="consultant-summary-card consultant-summary-card--blue">
        <h2>Business Information</h2>
        <ul class="consultant-summary-list">
          <li><strong>Business name:</strong> {{ consultant.business_name }}</li>
          <li><strong>Registration number:</strong> {{ consultant.registration_number|default:"—" }}</li>
        </ul>
      </article>

      <article class="consultant-summary-card consultant-summary-card--purple">
        <h2>Primary Documents</h2>
        {% if document_fields %}
          <ul class="consultant-document-list">
            {% for document in document_fields %}
              <li>
                <span class="consultant-document-label">{{ document.label }}</span>
                <a href="{{ document.url }}" target="_blank" rel="noopener">{{ document.name }}</a>
                <span class="consultant-document-meta">{{ document.type }} · {{ document.size }}</span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="consultant-card-empty">No documents have been uploaded.</p>
        {% endif %}
      </article>

      <article class="consultant-summary-card consultant-summary-card--pink">
        <h2>Staff Comment</h2>
        <p class="consultant-comment">{{ consultant.staff_comment|default:'Please remind the applicant to upload all supporting documents before final approval.' }}</p>
      </article>
    </section>

    {% include "consultants/documents/section.html" with
      section_class="consultant-panel consultant-panel--supporting"
      content_class="consultant-panel__body"
      title="Supporting documents"
      documents=supporting_documents
      upload_form=document_upload_form
      upload_url=document_upload_url
      next_url=document_next_url
      can_upload=can_manage_documents
      can_delete=can_manage_documents
      empty_message="No supporting documents uploaded yet."
    %}

    {% if decision_documents %}
      <section class="consultant-panel consultant-panel--decision">
        <div class="consultant-panel__body">
          <h2>Decision documents</h2>
          <ul class="consultant-document-list">
            {% for document in decision_documents %}
              <li>
                <span class="consultant-document-label">{{ document.label }}</span>
                <a href="{{ document.url }}" target="_blank" rel="noopener">{{ document.name }}</a>
                <span class="consultant-document-meta">{{ document.type }} · {{ document.size }}</span>
              </li>
            {% endfor %}
          </ul>
        </div>
      </section>
    {% endif %}

    <div class="consultant-detail-footer">
      <a class="consultant-detail-back" href="{% url 'staff_dashboard' %}">← Back to dashboard</a>
    </div>
  </div>
</div>
{% endblock %}
